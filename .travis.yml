language: c
sudo: false

# Coverity Scan uploads
env:
  global:
  # COVERITY_SCAN_TOKEN (rustyrussell/ccan)
  - secure: "RU+r62MYrhaUcFOiXykFt0lpFzQVL6f5gyAKOv39PpYK10rsI/cM6N8wOReH1EmI7ktn7M+g3Fs2jA+i+bZW4rZSfm379hzduWisEo0vEWNwyWiIrl1WjgGptFDwOCzMQHwo+u4zH6E+CAOWnje5Zw+elokVTfC1orLbuQHABG4="
  # COVERITY_SCAN_TOKEN (dgibson/ccan)
  - secure: "OL7OqYjQPE6rpHwujZbZt1gR5TNYn6Z0b1JxBaL1AG+iHlTbRrFGqec/VpYi2SAlqcDZK3x2lUzsF+hzx4pNBLFu8wvMtDKD4grlME5M+Bu3LT+YnmWSkaCw1/01n/SFyeRAkNDUJhnp0wS5oJ9sWx6trKWf9Xw9HpoKlwbFEGM="

addons:
  coverity_scan:
    project:
      name: CCAN
      #description: CCAN
    notification_email: ccan@lists.ozlabs.org
    build_command: make
    branch_pattern: coverity_scan

matrix:
  include:
  - compiler: gcc
    env: CFLAGS="-std=gnu99"
  - compiler: gcc-5
    env: GCOV="gcov-5"
    addons:
      apt:
        sources:
          - ubuntu-toolchain-r-test
        packages:
          - gcc-5
  - compiler: gcc-6
    env: GCOV="gcov-6"
    addons:
      apt:
        sources:
          - ubuntu-toolchain-r-test
        packages:
          - gcc-6
  - compiler: clang
    addons:
      apt:
        packages:
          - valgrind
  - dist: trusty
    addons:
      apt:
        packages:
          - valgrind
    env: CFLAGS="-std=gnu99"
    compiler: gcc
  - dist: trusty
    compiler: gcc-5
    env: GCOV="gcov-5"
    addons:
      apt:
        sources:
          - ubuntu-toolchain-r-test
        packages:
          - gcc-5
          - valgrind
  - dist: trusty
    compiler: gcc-6
    env: GCOV="gcov-6"
    addons:
      apt:
        sources:
          - ubuntu-toolchain-r-test
        packages:
          - gcc-6
          - valgrind
  - dist: trusty
    compiler: clang
    addons:
      apt:
        packages:
          - valgrind

script:
    - make -j2 -k quiet=1
    - make -k check quiet=1
